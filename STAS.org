#+title: Requerimientos STAS
#+author: Pedro Bustos <pedro.bustos@andessalud.cl>
#+OPTIONS: ^:nil


* Requerimentos
** DONE requerimiento ley urgencia hospitalizado [3/3]
DEADLINE: <2023-03-20 lun> SCHEDULED: <2023-03-16 jue>
*** DONE tabla HCU_LEY_URGENCIA [6/6]
  - [X] PAC_NUMFICHA_URG numeric 10
  - [X] PAC_NUMFICHA_HOSP numeric 10 null
  - [X] ING_CORREL_URG numeric 4
  - [X] ING_CORREL_HOSP numeric 4 null
  - [X] PTD_RUT char 10 null
  - [X] HLU_FEC_LEY_URG datetime null

*** DONE Eliminar cambios anteriores ley urgencia [3/3]
- [X] tabla ATENCION
- [X] spu_adm_obtener_atencion (pb)
- [X] spu_adm_guardar_atencion (pb)

*** DONE Componente ley urgencia hospitalizado [0/0]
- [X] guardar ingreso en hospitalizado debe verificar si paciente es ley urg
- [X] si paciente es ley urg se debe guardar pacnumficha e ingcorrel de hosp en HCU_LEY_URGENCIA
- [X] componente ley urgencia [2/2]
  + [X] Buscar en HCU_LEY_URGENCIA si paciente registra
  + [X] si registra muestra alert con fecha de registro

**** Lista de modificaciones
- API
  + AdimisionHospitalaria
  + Urgencia
- WEB
  + Urgencia
  + Clinica
- DB
  + HCU_LEY_URGENCIA C
  + spu_adm_registro_ley_urg C
  + spu_adm_obtener_pac_ley_urg C .
  + spu_fcu_guardar_atencion M
  + spu_fcu_obtener_atencion M

** DONE requerimiento suspender indicación hospitalizado [5/5]
DEADLINE: <2023-03-22 miÃ©> SCHEDULED: <2023-03-21 mar>
- [X] campo requiere kine debe ser required y tener opciones "si/no"
- [X] eliminar fecha hasta de vista/sp/tabla
- [X] al firmar debe verificar si campo kine true para agregar a lista kine
- [X] editar tabla HCH_PROCEDIMIENTO_MEDICO [2/2]
  + [X] HPM_ESTADO_PROCEDIMIENTO char 1 null (s = suspendido)
  + [X] HPM_FEC_ESTADO datetime null
- [X] agregar suspender indicación [3/3]
  + [X] agregar marca en objeto/db/sp/api para identificar suspendido
  + [X] si es suspendido debe mostrar alert 'Indicación suspendida el {fecha}'
  + [X] si se suspende con kine = true eliminar de lista kine
**** Lista de modificaciones
- API
  + FichaClinicaHospitalizado
- WEB
  + Clinica
- DB
  + HCH_PROCEDIMIENTO_MEDICO M
  + spu_fch_kine_obtener_pacientes_kinesioterapia M
  + spu_fch_guardar_procedimiento_medico M
  + spu_fch_obtener_procedimiento_medico M
  + spu_fch_anular_indicacion_procedimiento C

** DONE requerimiento rehabilitacion [2/2]
DEADLINE: <2023-03-23 jue> SCHEDULED: <2023-03-23 jue>
- [X] En vista kinesiologo, menu registro rehab [4/4]
  + [X] ocultar motivo de consulta
  + [X] agregar valor "otro" a escalas
    + Modificar tabla FRE_ESCALAS insert campo "otros"
  + [X] agregar campo invisible y required si hay escala elegida de texto libre "resultado escalas evaluadas"
    + Modificar tabla FCH_REHABILITACION nueva columna FRE_RES_ESCALA_EVAL varchar 1000 null desc 'Resultado de la escala evaluada'
  + [X] al marcar alugna escala debe aparecer campo "resultado escalas evaluadas"
- [X] Agregar campos en vue/sp/api/db para resultado escalas evaluadas
**** Lista de modificaciones
- API
  + FichaClinicaHospitalizado
- WEB
  + Clinica
- DB
  + FRE_ESCALAS M
    - INSERT INTO FRE_ESCALAS (FES_CORREL, FES_ESCALA, FES_VIGENTE) VALUES (5, 'OTROS', 'S')
  + FCH_REHABILITACION M
    - ALTER TABLE FCH_REHABILITACION ADD FRE_RES_ESCALA_EVAL varchar(1000)
  + spu_fch_kine_guardar_atencion M
  + spu_fch_kine_obtener_atencion M

** DONE requerimiento ficha rehabilitacion ambulatoria[11/11]
SCHEDULED: <2023-03-24 vie>
- [X] Agregar marca si es primera sesión
- [X] Ocultar motivo consulta
- [X] agregar valor "otro" a escalas
- [X] agregar campo invisible y required si hay escala seleccionada "resultado escalas evaluadas"
- [X] al marcar escala mostrar campo "resultado escalas evaluadas"
- [X] Agregar campos en vue/sp/api/db para resultado escalas evaluadas
  - spu_fca_kine_guardar_sesion_rehabilitacion
  - spu_fca_kine_listar_sesion_rehabilitacion
  - spu_fca_kine_actualizar_sesion_rehabilitacion
- boton finalizar tratamiento cierra todas las sesiones
- [X] Finalizar tratamiento finaliza sesion actual
- [X] en lista de pacientes "atender" revisa si es kine > atencion kine, de lo contrario atencion medico
- [X] primera sesion marca desde vue, valor dinamico en API
- [X] dejar boton de si/no para primera sesion en vue
- [X] lista de escalas separar con "," como en hospitalizado
**** Lista de modificaciones
- API
  + FichaClinicaAmbulatoria
- WEB
  + Ambulatorio
- DB
  + spu_fca_kine_guardar_sesion_rehabilitacion M
  + spu_fca_kine_listar_sesion_rehabilitacion M
  + spu_fca_kine_actualizar_sesion_rehabilitacion M
  + FSE_SESION_REHAB M
    - ALTER TABLE FRE_SESION_REHAB ADD FSR_RES_ESCALA_EVAL varchar(1000)

**** DUDAS
- Al guardar escalas no se guardan todas en lista, ayuda para revisar comportamiento


** DONE requerimento historial paciente
- historial paciente componente
- historial componente detalle

*** Lista detalles encontrados en fase QA [8/8]
- [X] En ver detalle cuadro resumen sesiones terapeuticas fecha al final  "invalid date"
- [X] campos no se bloquean al firmar atencion
- [X] al cambiar ingreso sigue apareciendo como firmado
  - Tenia que limpiar datos al cambiar ingreso en funcion cargarKinesiologia al usar "rowDblClickedIngreso"
- [X] Prestador no puede guardar ni Firmar si no es quien atiende
- [X] Required solo si es primera sesion
- [X] Firmar sesion guarda nueva sesion
  - Firmaba sesion con datos vacios ya que correl de sesion estaba vacio, faltaba mantener editando sesion actual para no perder correl
- [X] Al cargar sesion debe tomar datos automaticamente para poder seguir editando
- [X] al seleccionar una escala, guardarla y luego quitarla y guardar, no se puede volver a guardar
  - limpiar bien los datos antes de funcion editar


** DONE Requerimiento ENO tres proyectos [7/7]
- [X] Enfermedad > Diagnóstico ENO
- [X] Diagnostico alta eliminar de vista, api y sp
- [X] Identificar servicio de proveniencia del diagnostico ENO
- [X] en tabla ENO agregar boton para llevar a atención del paciente
- [X] en cada proyecto modificar buscar paciente para revisar marca desde store, si la encuentra utilizar datos de store para buscar paciente [3/3]
  - [X] Ambulatorio
  - [X] Urgencia
  - [X] Hospitalizado
- [X] En tabla ENO agregar columna servicio paciente
- [X] Agregar dato Servicio paciente en SP y API

** DONE Nueva Vista Otros profesionales Urgencia [9/9]
- [X] Crear Menu Otros Profesionales
- [X] Layout como en evolución Médica de hospitalizado
- [X] Crear Tabla URGENCIA_OTROS_PROFESIONALES [7/7]
  - [X] PAC_NUMFICHA numeric 10 not null
  - [X] ING_CORREL numeric 4 not null
  - [X] PTD_RUT char 10  null
  - [X] UOP_CORREL numeric 18 not null
  - [X] UOP_EVOLUCION varchar 1000 null
  - [X] UOP_FECHA_REG datetime null
  - [X] USU_LOGIN_CREA varchar 50 null
- [X] sp para guardar atencion otros profesionales
- [X] api para guardar atencion otros profesionales
  - tomar de ejemplo hospitalizado como guarda evolucion medica
    - NO OLVIDAR REGISTRAR REPOSITORY EN STARTUP
- [X] Error 500 al pedir evoluciones, pedir revisar api
- [X] Routes no deja entrar a vista otros profesionales, seguramente por falta permisos en DB
- [X] PENDIENTE Agregar funcion para firmar cada evolucion
  - Se crea funcion para firmar todas las evoluciones a nombre del prestador
- [X] Fix vista historial paciente
  - tomar vista alergias de hospitalizado y cambiar col-3 -> col-2 y col-7 -> col-8 en vista ppal
*** Cambios realizados
:PROPERTIES:
:ID:       bc204550-f762-4522-b761-956c20a90958
:END:
- WEB
  + Urgencia
- API
  + Urgencia
  + Common.Models
- DB
  + URGENCIA_OTROS_PROFESIONALES [[Vista Otros profesionales para clinica][CAMBIADO]]
    - script guardado en sqlbkp
  + MENU M
    - INSERT INTO MENU (MEN_CODIGO, MEN_NOMBRE, MEN_CODIGO_MEN, MEN_HREF, MEN_EXTERNO, ASU_CODIGO, MEN_ICON) VALUES (217, 'Otros Profesionales', 120, 7, '/otros-profesionales', 0, 4, NULL)
  + spu_adm_obtener_alergias M
    - formatear fecha para obtener hora con HH:mm
  + spu_fcu_guardar_evolucion_otros_profesionales [[Vista Otros profesionales para clinica][CAMBIADO]]
  + spu_fcu_obtener_evolucion_otros_profesionales [[Vista Otros profesionales para clinica][CAMBIADO]]

** DONE OTROS [2/2]
- [X] En urgencia revisar si es enfermera o es tens al hacer doble click en mapa cama
- [X] si es auditor enviar a atencion medico
** DONE Historial paciente en Urgencia [3/3]
- [X] Pasar componente
- [X] verificar que componente sea con filtro kine
- [X] arreglar visual componente

** DONE Notificacion GES [2/2]
- [X] Revisar problema de insert y retomar flujo
- [X] Hacer que notificacion GES utilizce tabla NOTIFICACION_PATOLOGIA_GES
*** Lista de cambios
- DB
  - CREATE TABLE NOTIFICACION_PATOLOGIA_GES C
  - INSERT NOTIFICACION_PATOLOGIA_GES SELECT FROM NOTIFICACION_GES C
  - spu_fcu_eliminar_notificacion_ges M
  - spu_fcu_guardar_notificacion_ges M
  - spu_fcu_inf_constancia_ges M
  - spu_fcu_listar_notificaciones M
  - spu_fcu_obtener_notificacion_ges M

** DONE Bugs encontrados [5/5]
- [X] Historial Esi error dato
  - Tenia error al intentar enviar lista vacia, se agrega verificacion de length
- [X] Categorizacion
  - error de sp verificaba si HE_CORREL IS NULL en lugar incorrecto, se quita
- [X] En urgencia atencion al ingresar anamnesis e hip diagnostica y guardar sin marcar ley urg da error al intentar insertar datos vacios
- [X] En urgencia atencion se guarda duplicado la anamnesis e hip diagnostica
- [X] En Clinica no deja ingresar texto complementario en epicrisis

** DONE Firmar enfermera [5/5]
- [X] Firmar evoluciones a nombre enfermera, como en otros profesionales
- [X] En vue enviar todas las evoluciones que correspondan al usuLogin
- [X] en API agregar campo bool para comprobar si evolucion esta firmada
- [X] en SP verificar si atencion está firmada y si es asi insertar fecha en campo fecha fin evolucion
- [X] en DB agregar columna fecha fin evolucion en tabla que corresponda
  - ALTER TABLE REG_PROCED_ENFERMERIA ADD RPE_FECHA_FIN_EVO DATETIME

*** Lista de cambios
- API
  + Urgencia
  + Common.Models
- WEB
  + Urgencia
- DB
  + spu_fcu_guardar_procedimiento_enfermeria
  + spu_fcu_obtener_procedimiento_enfermeria
  + REG_PROCED_ENFERMERIA M
    - ALTER TABLE REG_PROCED_ENFERMERIA ADD RPE_FECHA_FIN_EVO DATETIME
    - Trigger: val_reg_proced_enfermeria_upd

** DONE Vista Otros profesionales para clinica [5/5]
- [X] Tomar template de vista nutri
- [X] modificar tabla URGENCIA_OTROS_PROFESIONALES [3/3]
  + [X] Nuevo nombre: HC_OTROS_PROFESIONALES
  + [X] Campos de UOP a HOP
  + [X] nueva columna SER_CODIGO varchar 3
- [X] Modificar otros profesionales urgencia [9/9]
  + [X] Vue: Cambiar nombres de propiedades uop -> hop
  + [X] Vue: Agregar a objeto serCodigo
  + [X] Api: Agregar a DTO SerCodigo string
  + [X] Api: Cambiar nombres de propiedades Uop -> Hop
  + [X] SP: Cambiar nombre tabla URGENCIA_OTROS_PROFESIONALES -> HC_OTROS_PROFESIONALES
  + [X] SP: Campos de UOP a HOP
  + [X] SP: Agregar al obtener SER_CODIGO
  + [X] SP: Agregar al guardar SER_CODIGO
  + [X] Ver opcion de dejar sp globales en lugar de solo para urgencia
    - spu_gen_guardar_evolucion_otros_profesionales
    - spu_gen_obtener_evolucion_otros_profesionales
- [X] En vue asegurar objeto tenga propiedades necesarias para api
- [X] En api construir DTO controller y repository con template urgencia otros profesionales

*** Lista de cambios
- WEB
  + Urgencia M
    - atencion-otros-profesionales M
  + Clinica M
    - atencion-otres-profesionales C
- API
  + Urgencia M
    - EvolucionOtrosProfesionalesDTO M
    - OtrosProfesionalesRepository M
  + FichaClinicaHospitalizado M
    - OtrosProfesionalesCotroller C
    - OtrosProfesionalesRepository C
    - EvolucionOtrosProfesionalesDTO C
- DB
  + HC_OTROS_PROFESIONALES C/M cambiado de URGENCIA_OTROS_PROFESIONALES y se añade columna SER_CODIGO
  + spu_gen_guardar_evolucion_otros_profesionales M/C cambiado nombre fcu y ajustado a nuevo req
  + spu_gen_obtener_evolucion_otros_profesionales M/C cambiado nombre fcu y ajustado a nuevo req

    duda: insert en MENU otros profresionales para URG debe ir en carpeta urgencia?
    en guardar_categorizacion se encuentra tabla Signos_vitales_esi. Tabla tiene pocos datos, no recuerdo de donde sale
    si se usa porque ahi guarda la relacion respecto a qué ESI corresponde el signo vital guardado

** DONE Agregar visor clinico a urgencia y hospitalizado [5/5]
- [X] Copiar desde ambulatorio
- [X] cambios en store
- [X] Agregar endpoint en global
- [X] En urgencia sólo en vistas médico [2/2]
  - [X] Atencion
  - [X] Atencion Especialista
- [X] En clinica sólo en evolución médica
- Pasos para agregar visor clinico
  1. Agregar getEsVisorClinico a store
  2. Agregar endpoint VisorClinico a service/global.js
  3. agregar botón Visor Clínico
  4. agregar imports
     a. import VisorClinico from global
     b. import VueCryptoJs from vue-cryptojs
     c. vue.use(vuecryptojs)
  5. agregar llamada a endpoint en created()
  6. agregar método openVisorClinico

** Pruebas Proceso Urgencia
- En atencion se guarda al estar vacío. Correcto?
- En medicamento no deja elegir cada X Días, sólo deja elegir cada X veces
- En atencion especialista Médico puede guardar.
- En atencion especialista historial paciente duplicado
- En atencion enfermeria médico puede guardar y agregar procedimientos enf

** Pruebas Proceso Hospitalizado
- Error al imprimir epicrisis, falla en reporte
- Al seleccionar todo, no borra evoluciones, si los selecciono uno a uno se borran
- En mapa cama revisar los perfiles "otros profesionales" para redireccionar a vista otros-profesionales

** DONE Requerimiento traspasar cargos urgencia a hospitalizado [2/2]
- [X] En VUE [3/3]
  - [X] Agregar parametro orgien a ficha
  - [X] Utilizar parametro local origen para verificar orgien paciente es URG
  - [X] Limpiar datos debe limpiar parametro origen
- [X] En API [2/2]
  - [X] Debe usar sp traspaso cargo si origen es URG
  - [X] Debe enviar como parametro bool TraspasarCargos

*** Lista de modificaciones
- VUE
  - Cliinca
    - Admision M
- API
  - AdmisionHospitalaria
    - AdmisionRepository M
- DB
  - N/A

** DONE Requerimiento Informes Medico Auditor Ambulatorio [2/2]
- [X] Crear rama a partir de Master
- [X] Dejar que boton informes medicos pueda usarlo Auditor
  - se quita disabled
*** Lista de cambios
- VUE
  - ambulatorio
    - registro-atencion M
- API
  - N/A
- DB
  - N/A
- GIT
  - feature-auditor-informes-medicos C

** DONE Requerimento informes medico Kine Ambulatorio [2/2]
- [X] Utilizar rama feature-cambios-ficha-rehabilitacion ( Cambios de esa rama [[requerimiento ficha rehabilitacion ambulatoria][aqui]] )
- [X] Agregar botón informes medicos en vista Kine
  - NOTA: Historial paciente no presente en feature-ficha-rehabilitacion, estan en feature-historial-paciente-kine. Conusltar si hacer merge a ambas
*** Lista de cambios
- VUE
  - kinesiologosM
- API
  - N/A
- DB
  - N/A
- GIT
  - feature-cambios-ficha-rehabilitacion M

** DONE Requerimiento gestion GES [4/4]
SCHEDULED: <2023-05-22 lun>
- [X] Agregar en todas los proyectos una vista para gestionar notificaciones GES [3/3]
  - [X] ambulatorio feature desde rama master
  - [X] urgencia feature desde qa
  - [X] clinica feature desde qa
- [X] La vista debe ser una tabla con la lista de pacientes de GES del último mes
- [X] se debe poder buscar por rut y fecha (tomar ejemplo vista ENO) [2/2]
  - [X] Rut
  - [X] Fecha
- [X] Listado (Vuetable) [9/9]
  - [X] Rut
  - [X] Paciente
  - [X] Ficha
  - [X] Ingreso
  - [X] Fecha Notificacion
  - [X] Diagnostico
  - [X] Patologia
  - [X] Medico
  - [X] Imprimir
*** Lista de cambios
- WEB
  - Clinica
    - gestion-ges C
    - helper/global M
    - routes M
  - Urgencia
    - gestion-ges C
    - helper/global M
    - routes M
  - Ambulatorio
    - gestion-ges C
    - helper/global M
    - routes M

- API
  - Global M
    - notificacionController M
    - notificacionRepository M
    - Common.Models M
- DB
  - INSERT INTO MENU para los tres proyectos M
  - spu_fce_ges_listar_notificaciones C
- GIT
  - Clinica
    - feature-gestion-ges C (desde QA)
  - Urgencia
    - feature-gestion-ges C (desde QA)
  - Ambulatorio
    - feature-gestion-ges C (desde master)

| Buscar  | Por Rut paciente         |       |         |                    |             |           |        |                  |
|         | Por Fecha                |       |         |                    |             |           |        |                  |
|         | Por Rut paciente y Fecha |       |         |                    |             |           |        |                  |
|         |                          |       |         |                    |             |           |        |                  |
| Flitrar | Por Rut Prestador        |       |         |                    |             |           |        |                  |
|         |                          |       |         |                    |             |           |        |                  |
| Rut     | Paciente                 | Ficha | Ingreso | Fecha Notificacion | Diagnostico | Patologia | Medico | Imprimir (Boton) |
|         |                          |       |         |                    |             |           |        |                  |
|         |                          |       |         |                    |             |           |        |                  |
